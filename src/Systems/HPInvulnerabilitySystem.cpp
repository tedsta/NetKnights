#include "Systems/HPInvulnerabilitySystem.h"

#include "Components/HitPoints.h"

HPInvulnerabilitySystem::HPInvulnerabilitySystem(fsn::EntityManager& entityMgr) : fsn::ComponentSystem(entityMgr)
{
    all<HitPoints>();
}

void HPInvulnerabilitySystem::processEntity(const fsn::EntityRef& entity, const float dt)
{
    auto& hp = entity.getComponent<HitPoints>();

    for (auto damager = hp.mDamagers.begin(); damager != hp.mDamagers.end();)
    {
        damager->invulLeft--;

        if (damager->invulLeft == 0)
        {
            damager = hp.mDamagers.erase(damager);
        }
        else
            damager++;
    }
}
